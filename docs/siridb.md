# TSBS Supplemental Guide: SiriDB

SiriDB is afully open source time-series database with cluster support for scaling and redundancy. It is written in native C and the source code and documentation on how to install SiriDB can be found on [Github](https://github.com/SiriDB/siridb-server).
This supplemental guide explains how the data generated for TSBS is stored, additional flags available when using the data importer (`tsbs_load_siridb`), and additional flags available for the query runner (`tsbs_run_queries_siridb`). **This should be read *after* the main README.**

## Data format

Data generated by `tsbs_generate_data` for SiriDB is serialized by using a couple of headers to indicate the number of bytes that will follow. The first 2 bytes include the number of metrics, the next 2 bytes the number of bytes needed to cover the measurement name and tags. This is the first header and the part after this header will include the measurement name and tags. Follow next is the second header with iformation about the fields. The first 2 bytes of the header include the length of the field key, followed by 2 bytes that include the length of the timestamp and field value. The timestamp and field value are packed with [go-qpack](https://github.com/transceptor-technology/go-qpack). Go-qpack serializes the data in the right format for SiriDB.

This format is not (easily) human readable in its serialized format, but a simplified example for the `cpu-only` use case would be of this format:
```text
[number of metrics] [length of name and tags]["cpu|hostname=host_0,region=eu-central-1,datacenter=eu-central-1b,
rack=21,os=Ubuntu15.10,arch=x86,team=SF,service=6,service_version=0,service_environment=test]
[length of field key] [length of timestamp and field value] [|usage_user]   [ts, value]
[length of field key] [length of timestamp and field value] [|usage_system] [ts, value]

... etc.
```
The measurement name, tags and field key will compose the SiriDB series name when the data is inserted.

---


## `tsbs_load_siridb` Additional Flags

### Database related

#### `-dbuser` (type: `string`, default: `iris`)
The database user to authenticate.


#### `-dbpass` (type: `string`, default: `siri`)
The database password to authenticate.


<!-- #### `-replica` (type: `boolean`, default: `false`) -->

#### `-hosts` (type: `string`, default: `localhost:9000`)
A single hostname or comma separated list of host names for the SiriDB servers. Should include the port number. The number of hosts in this list will indicate the number of pools created. And this should be the same as the number of workers.

#### `-write-timeout` (type: `int`, default: `10`)
Length of the timeout for writes.


### Miscellaneous

#### `-log-batches` (type: `boolean`, default: `false`)
Whether to time individual batches.



## `tsbs_run_queries_siridb` Additional Flags

### Database related

#### `-dbuser` (type: `string`, default: `iris`)
The database user to authenticate.

#### `-dbpass` (type: `string`, default: `siri`)
The database password to authenticate.

#### `-hosts` (type: `string`, default: `localhost:9000`)
A single hostname or comma separated list of host names for the SiriDB servers. Should include the port number.

#### `-scale` (type: `int`, default: `8`)
The scale is important for creating the right groups. It is the number of hosts for which data is generated. So it should be the same as the scale (number of hosts) of the inserted data. This number is used to create a group for every host.

#### `-write-timeout` (type: `int`, default: `10`)
Length of the timeout for writes.

### Miscellaneous

#### `-show-explain` (type: `boolean`, default: `false`)
Whether to print out a sample output for the first query in the set of queries. This will be the only query run and is useful for understanding the query plan that is being generated for a particular
query type.